return {
  {
    "olimorris/codecompanion.nvim",
    dependencies = {
      "nvim-lua/plenary.nvim",
      "nvim-treesitter/nvim-treesitter",
      -- "hrsh7th/nvim-cmp", -- Optional: For using slash commands and variables in the chat buffer
      -- "nvim-telescope/telescope.nvim", -- Optional: For using slash commands
      -- { "MeanderingProgrammer/render-markdown.nvim", ft = { "markdown", "codecompanion" } }, -- Optional: For prettier markdown rendering
      -- { "stevearc/dressing.nvim", opts = {} }, -- Optional: Improves `vim.ui.select`
    },
    config = true,
    opts = {
      -- strategies = {
      --   chat = {
      --     adapter = "groq",
      --   },
      --   -- inline = {
      --   --   adapter = "openai",
      --   -- },
      -- },
      strategies = {
        chat = { adapter = "deepseek" },
        inline = { adapter = "deepseek" },
        agent = { adapter = "deepseek" },
      },
      adapters = {
        groq = function()
          return require("codecompanion.adapters").extend("groq", {
            env = {
              api_key = os.getenv("GROQ_API_KEY"),
            },
          })
        end,
        openai = function()
          return require("codecompanion.adapters").extend("openai", {
            env = {
              api_key = os.getenv("OPENAI_API_KEY"),
            },
          })
        end,
        deepseek = function()
          return require("codecompanion.adapters").extend("deepseek", {
            env = {
              api_key = os.getenv("DEEPSEEK_API_KEY"),
            },
          })
        end,
      },
    },
    -- config = function(_, opts)
    --   require("codecompanion").setup({
    --     adapters = {
    --       openai = function()
    --         return require("codecompanion.adapters").extend("openai", {
    --           env = {
    --             api_key = os.getenv("OPENAI_API_KEY"),
    --           },
    --         })
    --       end,
    --     },
    --   })
    --   -- require("mason").setup(opts)
    --   -- local mr = require("mason-registry")
    --   -- mr:on("package:install:success", function()
    --   --   vim.defer_fn(function()
    --   --     -- trigger FileType event to possibly load this newly installed LSP server
    --   --     require("lazy.core.handler.event").trigger({
    --   --       event = "FileType",
    --   --       buf = vim.api.nvim_get_current_buf(),
    --   --     })
    --   --   end, 100)
    --   -- end)
    --
    --   -- mr.refresh(function()
    --   --   for _, tool in ipairs(opts.ensure_installed) do
    --   --     local p = mr.get_package(tool)
    --   --     if not p:is_installed() then
    --   --       p:install()
    --   --     end
    --   --   end
    --   -- end)
    -- end,
  },
}
